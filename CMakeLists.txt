cmake_minimum_required(VERSION 3.21) # ROCM support

project(mitransform_kernels C CXX)

add_subdirectory(ThirdParty/res_embed)

include(ResEmbed)

file(GLOB KERNELS "src/*.cl")
file(GLOB KERNEL_INCLUDES "include/*.h*")
add_library(${PROJECT_NAME} SHARED ${CMAKE_CURRENT_SOURCE_DIR}/src/mitransform_kernels.cpp)

foreach(KERNEL ${KERNELS} ${KERNEL_INCLUDES})
	get_filename_component(KERNEL_NAME ${KERNEL} NAME)
	# Resources names are used directly in the C++ code generated by res_embed.
	# For this reason, we have to make the name legal by replacing dots.
	string(REPLACE "." "_" KERNEL_NAME_LEGAL ${KERNEL_NAME})
	res_embed(TARGET ${PROJECT_NAME} NAME ${KERNEL_NAME_LEGAL} PATH ${KERNEL})
endforeach()

